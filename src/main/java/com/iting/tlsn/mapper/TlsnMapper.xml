<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iting.tlsn.mapper.TlsnMapper">
	<!-- 전체수강목록 -->
	<select id="getTlsnList">
		SELECT l.LT_NUM
		       , l.LT_TTL
		       , find_code(LT_CATE_CD) LT_CATE_CD
		       , l.LECTURER_NUM
		       , m.MEM_NUM
		       , t.TLSN_NUM
		       , t.TLSN_ST_CD
		       , t.CETE_YN_CD
		       , t.APPL_DT
		       , e.NAME
		       , e.ID
		       , e.ADDR
		       , e.DETAIL_ADDR
		       , e.MAIL
		       , e.PHONE
		FROM TLSN t JOIN LT l
		              ON t.LT_NUM = l.LT_NUM
		            JOIN MEM m
		              ON t.MEM_NUM = m.MEM_NUM
		            JOIN LECTURER e
		              ON l.LECTURER_NUM = e.LECTURER_NUM
		WHERE m.MEM_NUM = #{user}
		ORDER BY t.APPL_DT DESC
	</select>
	
	<select id="getTlsnInfo" parameterType="TlsnVO" resultType="TlsnVO">
		SELECT l.LT_NUM
		, l.LT_TTL
		, l.LECTURER_NUM
        , e.NAME
		FROM LT l JOIN LECTURER e
                    ON l.LECTURER_NUM = e.LECTURER_NUM
		WHERE l.LT_NUM = #{ltNum}
	</select>
	
	<insert id="tlsnInsert" parameterType="TlsnVO">
		<selectKey keyProperty="tlsnNum"
					order="BEFORE"
					resultType="string">
			SELECT 'tl' || LPAD(NVL(MAX(SUBSTR(tlsn_num, -5)), 0) + 1, 5, '0') 
			FROM tlsn
		</selectKey>
		INSERT INTO tlsn (
						  tlsn_num
						, tlsn_st_cd
						, mem_num
						, lt_num
						, cete_yn_cd
						, appl_dt
                  		 )
		VALUES (
		          #{tlsnNum}
		        , #{tlsnStCd}
		        , #{memNum}
		        , #{ltNum}
		        , #{ceteYnCd}
		        , SYSDATE
		        )
	</insert>
	
	<!-- 수강 단건조회 -->
	<select id="getTlsnInfo" parameterType="TlsnVO">
		SELECT tlsn_num
		        , tlsn_st_cd
		        , mem_num
		        , lt_num
		        , cete_yn_cd
		        , appl_dt
		FROM tlsn
		WHERE mem_num = #{memNum}
		AND lt_num = #{ltNum}
	</select>
</mapper>