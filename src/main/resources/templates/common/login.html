<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="/css/member/bootstrap.min.css"
	type="text/css">
<link rel="stylesheet" href="/css/member/nice-select.css"
	type="text/css">
<link rel="stylesheet" href="/css/member/style.css" type="text/css">
<script src="https://code.jquery.com/jquery-1.12.1.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script
	src="/js/join/naverlogin.js" charset="utf-8"></script>
<title>로그인</title>
<style>
.container {
	margin: 0 auto;
}

.logo {
	width: 150px;
}

.naverbtn {
	width: 200px;
}
</style>

</head>

<body>
	<div class="container">
		<form th:action="@{/userlogin}" method="post" name="frm">
			<img class="logo" src="img/common/logo_h.png" alt="Logo" />
			<div class="col-lg-6">
				<div class="checkout__input">
					<p>아이디</p>
					<input type="text" name="userId" />
				</div>
			</div>
			<div class="col-lg-6">
				<div class="checkout__input">
					<p>비밀번호</p>
					<input type="password" name="password" />
				</div>
			</div>
			<div class="col-lg-6">
				<button type="submit" class="site-btn">로그인</button>
			</div>
		</form>
		<div class="col-lg-6">
			<a href="#">아이디찾기</a> | <a id="nlogout" href="#">비밀번호찾기</a> | <a href="/account">회원가입</a>
		</div>
		<div class="col-lg-6" id="naverIdLogin">
			<a id="naverIdLogin_loginButton" href="#" role="button"></a>
		</div>
	</div>
	</script>
	<script>
		frm.addEventListener("submit", (e) => {
			e.preventDefault();
			let id = frm.userId.value;
			let pw = frm.password.value;
			if (id == '') {
				alert("아이디를 입력해주세요")
				return;
			} else if (pw == '') {
				alert("비밀번호를 입력해주세요")
				return;
			} else {
				frm.submit();
			}
		});
		// (3) LoginWithNaverId Javscript 설정 정보 및 초기화
			var naverLogin = new naver.LoginWithNaverId(
				{
					clientId: "IUFmLIwupwmkJxh3eacH",
					callbackUrl: "http://localhost:8081/login",
					isPopup: false,
					loginButton: {color: "green", type: 3, height: 50},
					callbackHandle: true
				}
			);
			/* (4) 네아로 로그인 정보를 초기화하기 위하여 init을 호출 */
			naverLogin.init();
			
			/* (4-1) 임의의 링크를 설정해줄 필요가 있는 경우 */
			$("#nlogout").attr("href", naverLogin.generateAuthorizeUrl());

			/* (5) 현재 로그인 상태를 확인 */
			window.addEventListener('load', function () {
				naverLogin.getLoginStatus(function (status) {
					if (status) {
						/* (6) 로그인 상태가 "true" 인 경우 사용자 정보를 출력합니다. */
						console.log(naverLogin.user);
						console.log(naverLogin.generateAuthorizeUrl());
						naverLogin.logout();
						setLoginStatus();
					}
				});
			});

			/* (6) 로그인 상태가 "true" 인 경우 사용자 정보를 출력합니다. */
			function setLoginStatus() {
				let naverId = naverLogin.user.getEmail();
				// let nickName = naverLogin.user.get();
				/* (7) 로그아웃 버튼을 설정하고 동작을 정의합니다. */
				$("#nlogout").click(function (e) {
					e.preventDefault();
					naverLogin.logout();
					location.replace('/member/main');
				});
			}
	</script>
</body>

</html>